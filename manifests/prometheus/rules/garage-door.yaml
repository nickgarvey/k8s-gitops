apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: garage-door-alerts
  namespace: prometheus
  labels:
    app.kubernetes.io/managed-by: ngarvey-homelab
    prometheus: prometheus
spec:
  groups:
    - name: homeassistant.garage
      rules:
        - alert: GarageDoorOpenTooLong
          expr: homeassistant_cover_state{domain="cover", entity="cover.garage_door", state="open"} > 0
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: "Garage door has been open for over 10 minutes"
            description: "The garage door ({{ $labels.friendly_name }}) has been in the open state for more than 10 minutes."
        - alert: GarageDoorOpenTooLongCritical
          expr: homeassistant_cover_state{domain="cover", entity="cover.garage_door", state="open"} > 0
          for: 30m
          labels:
            severity: critical
          annotations:
            summary: "Garage door has been open for over 30 minutes"
            description: "The garage door ({{ $labels.friendly_name }}) has been in the open state for more than 30 minutes. Initiating phone call."

