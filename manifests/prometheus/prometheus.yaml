apiVersion: monitoring.coreos.com/v1
kind: Prometheus
metadata:
  name: prometheus
  namespace: prometheus
  labels:
    app.kubernetes.io/managed-by: ngarvey-homelab
spec:
  replicas: 1
  version: v3.8.1
  serviceAccountName: prometheus

  # Select all ServiceMonitors, PodMonitors, and ScrapeConfigs across all namespaces
  serviceMonitorSelector: {}
  serviceMonitorNamespaceSelector: {}
  podMonitorSelector: {}
  podMonitorNamespaceSelector: {}
  scrapeConfigSelector: {}
  scrapeConfigNamespaceSelector: {}

  # Retention settings
  retentionSize: 22GB

  # Resource limits
  resources:
    requests:
      cpu: 100m
      memory: 1Gi
    limits:
      cpu: 500m
      memory: 2Gi

  # Storage configuration
  storage:
    volumeClaimTemplate:
      spec:
        storageClassName: longhorn-wffc
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 25Gi

  # Security context for storage permissions
  securityContext:
    runAsNonRoot: true
    runAsUser: 65534
    runAsGroup: 65534
    fsGroup: 65534

  # Enable admin API for lifecycle management
  enableAdminAPI: true

  # AlertManager configuration
  alerting:
    alertmanagers:
      - namespace: prometheus
        name: alertmanager
        port: web

  # Select all PrometheusRules across all namespaces
  ruleSelector: {}
  ruleNamespaceSelector: {}

